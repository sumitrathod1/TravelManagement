import{a as g}from"./chunk-WEZ5LNJ3.js";import{X as f,_ as s,a as p,b as u,ba as w,da as a,j as h,k as m}from"./chunk-QUTPPCZH.js";var y=new w("JWT_OPTIONS"),c=(()=>{class n{constructor(e=null){this.tokenGetter=e&&e.tokenGetter||function(){}}urlBase64Decode(e){let t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:{t+="==";break}case 3:{t+="=";break}default:throw new Error("Illegal base64url string!")}return this.b64DecodeUnicode(t)}b64decode(e){let t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",o="";if(e=String(e).replace(/=+$/,""),e.length%4===1)throw new Error("'atob' failed: The string to be decoded is not correctly encoded.");for(let l=0,d,i,k=0;i=e.charAt(k++);~i&&(d=l%4?d*64+i:i,l++%4)?o+=String.fromCharCode(255&d>>(-2*l&6)):0)i=t.indexOf(i);return o}b64DecodeUnicode(e){return decodeURIComponent(Array.prototype.map.call(this.b64decode(e),t=>"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)).join(""))}decodeToken(e=this.tokenGetter()){return e instanceof Promise?e.then(t=>this._decodeToken(t)):this._decodeToken(e)}_decodeToken(e){if(!e||e==="")return null;let t=e.split(".");if(t.length!==3)throw new Error("The inspected token doesn't appear to be a JWT. Check to make sure it has three parts and see https://jwt.io for more.");let o=this.urlBase64Decode(t[1]);if(!o)throw new Error("Cannot decode the token.");return JSON.parse(o)}getTokenExpirationDate(e=this.tokenGetter()){return e instanceof Promise?e.then(t=>this._getTokenExpirationDate(t)):this._getTokenExpirationDate(e)}_getTokenExpirationDate(e){let t;if(t=this.decodeToken(e),!t||!t.hasOwnProperty("exp"))return null;let o=new Date(0);return o.setUTCSeconds(t.exp),o}isTokenExpired(e=this.tokenGetter(),t){return e instanceof Promise?e.then(o=>this._isTokenExpired(o,t)):this._isTokenExpired(e,t)}_isTokenExpired(e,t){if(!e||e==="")return!0;let o=this.getTokenExpirationDate(e);return t=t||0,o===null?!1:!(o.valueOf()>new Date().valueOf()+t*1e3)}getAuthScheme(e,t){return typeof e=="function"?e(t):e}}return n.\u0275fac=function(e){return new(e||n)(a(y))},n.\u0275prov=s({token:n,factory:n.\u0275fac}),n})();var b=class n{constructor(r){this._http=r}baseUrl="http://ezygoa.icu/api/User/";employeeCountSubject=new m(0);employeCount$=this.employeeCountSubject.asObservable();employeUpdatedSubject=new h;employeeUpdated$=this.employeUpdatedSubject.asObservable();addEmployee(r){let e=u(p({},r),{EmployeeDOB:r.DOB?new Date(r.DOB).toISOString().split("T")[0]:null,Role:r.Role==="Admin"?0:1,Licence:r.Licence==="LMVC"?0:r.Licence==="Badge"?1:2});return console.log("Employee data to be sent (emp object):",e),this._http.post(`${this.baseUrl}Register`,e).pipe(f(()=>{this.employeUpdatedSubject.next()}))}getAllEmployees(){return this._http.get(`${this.baseUrl}getall-Users`)}updateEmployeeCount(r){this.employeeCountSubject.next(r)}loginUser(r){return this._http.post(`${this.baseUrl}authenticate`,r)}storeTokan(r){localStorage.setItem("token",r)}getToken(){return localStorage.getItem("token")}isloggedIn(){return!!localStorage.getItem("token")}decodeToken(){let r=new c,e=this.getToken();return console.log(r.decodeToken(e)),r.decodeToken(e)}getRoleFromToken(){let r=localStorage.getItem("token");return r&&new c().decodeToken(r)["http://schemas.microsoft.com/ws/2008/06/identity/claims/role"]||null}getUserIdFromToken(){let r=this.decodeToken();return r&&r["http://schemas.xmlsoap.org/ws/2005/05/identity/claims/nameidentifier"]||null}getEmployeeBookings(){return this._http.get(`${this.baseUrl}ViewBookings`,{params:{id:2}})}static \u0275fac=function(e){return new(e||n)(a(g))};static \u0275prov=s({token:n,factory:n.\u0275fac,providedIn:"root"})};export{c as a,b};
